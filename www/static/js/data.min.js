var ES;ES||(ES={}),function(){ES.init=function(){$.getJSON("https://pgp-uk.github.io/data/json/data.json",function(t){var e=ES.initializeTable(t,"table");$.getJSON("https://pgp-uk.github.io/data/json/out.json",function(t){ES.makePlotIconClickable(e,"table",t,".file_btn"),$('[data-toggle="tooltip"]').tooltip()}),$.getJSON("https://pgp-uk.github.io/data/json/phenotype_latest.json",function(t){ES.makePlotIconClickable(e,"table",t,".trait_btn"),$('[data-toggle="tooltip"]').tooltip()})})},ES.initializeTable=function(t,e){t=ES.addPlotIconToTopTable(t);var a=$("#"+e).DataTable({data:t,responsive:!0,iDisplayLength:25,pagingType:"full",order:[[1,"asc"]],columnDefs:[{targets:4,orderable:!1}]});return a},ES.addPlotIconToTopTable=function(t){for(var e='<button type="button" class="btn btn-default trait_btn" aria-label="Trait Data" data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="Phenotype Data"><span class="glyphicon glyphicon-user" aria-hidden="true"></span></button>&nbsp;&nbsp;<button type="button" class="btn btn-default file_btn" aria-label="Download Files" data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="Download Files"><span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span></button>',a=0;a<t.length;a++)t[a].push(e);return t},ES.makePlotIconClickable=function(t,e,a,i){$("#"+e).on("click",".close",function(){var e=$(this).closest("tr").prev()[0],a=t.row(e);a.child.hide(),e.removeClass("shown")}),$("#"+e).on("click",i,function(){var e=$(this).closest("tr"),r=e.children("td")[0],n=$(r).text(),s=t.row(e);".trait_btn"==i?ES.openTraitsChildRow(s,e,a,n):ES.openFilesChildRow(s,e,a,n)})},ES.openTraitsChildRow=function(t,e,a,i){if(t.child.isShown()&&1===$(t.child()).find("#traits_"+i).length)t.child.hide(),e.removeClass("shown");else{var r=a[i],n=$("#traits_template").clone().attr("id","traits_"+i).show();n=ES.updateTraitsHtml(r,n),t.child(n).show(),e.addClass("shown")}},ES.openFilesChildRow=function(t,e,a,i){if(t.child.isShown()&&1===$(t.child()).find("#files_"+i).length)t.child.hide(),e.removeClass("shown");else{var r=a[i],n=$("#files_template").clone().attr("id","files_"+i).show();n=ES.addBamFileHref(n,r),n=ES.addFastqFilesHref(n,r),n=ES.addSraFileHref(n,r),n=ES.addVcfFilesHref(n,r),n=ES.addIdatFilesHref(n,r),t.child(n).show(),e.addClass("shown")}},ES.addBamFileHref=function(t,e){var a="ftp://"+e.ena[0].submitted_ftp;return $(t).find(".ena_bam_file").attr("href",a),t},ES.addFastqFilesHref=function(t,e){var a=e.ena[0].fastq_ftp.split(";"),i="ftp://"+a[0];$(t).find(".ena_fastq_1_file").attr("href",i);var r="ftp://"+a[1];return $(t).find(".ena_fastq_2_file").attr("href",r),t},ES.addSraFileHref=function(t,e){var a="ftp://"+e.ena[0].sra_ftp;return $(t).find(".ena_sra_file").attr("href",a),t},ES.addVcfFilesHref=function(t,e){var a=e.eva[0].submitted_ftp.split(";"),i="ftp://"+a[0];$(t).find(".eva_vcf_file").attr("href",i);var r="ftp://"+a[1];return $(t).find(".eva_vcf_tabix_file").attr("href",r),t},ES.addIdatFilesHref=function(t,e){if(void 0===e.arrayexpress)$(t).find(".array_express_file_data_row").hide();else{$(t).find(".array_express_file_data_row").show();for(var a=0;a<e.arrayexpress.length;a++){var i="https://www.ebi.ac.uk/arrayexpress/files/"+e.arrayexpress[a].accession+"/"+e.arrayexpress[a].accession+".raw.1.zip/"+e.arrayexpress[a].array_data_file,r=e.arrayexpress[a].array_data_file.split("_")[2],n=e.arrayexpress[a].characteristicsorganism_part;"blood"==n?"Red.idat"==r?$(t).find(".array_express_blood_idat_red_file").attr("href",i):$(t).find(".array_express_blood_idat_green_file").attr("href",i):"Red.idat"==r?$(t).find(".array_express_saliva_idat_red_file").attr("href",i):$(t).find(".array_express_saliva_idat_green_file").attr("href",i)}}return t},ES.updateTraitsHtml=function(t,e){return void 0===t?($(e).find(".info_table").remove(),$(e).find(".survey_sub_text").text("There is no trait data associated with this participant currently.")):($(e).find(".survey_gender").text(t[1]),$(e).find(".survey_date_of_birth").text(t[2]),$(e).find(".survey_age_at_sample_collection").text(t[3]),$(e).find(".survey_current_smoker").text(t[4]),$(e).find(".survey_ex_smoker").text(t[5]),$(e).find(".survey_blood_type").text(t[6]),$(e).find(".survey_handedness").text(t[7]),$(e).find(".survey_weight").text(t[8]),$(e).find(".survey_height").text(t[9]),$(e).find(".survey_hair_colour").text(t[10]),$(e).find(".survey_right_eye_colour").text(t[11]),$(e).find(".survey_left_eye_colour").text(t[12]),$(e).find(".survey_date").text(t[13])),e}}();