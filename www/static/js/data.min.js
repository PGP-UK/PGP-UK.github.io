var ES;ES||(ES={}),ES.init=function(){$.getJSON("https://www.personalgenomes.org.uk/data/json/data.json",function(e){var t=ES.initializeTable(e,"table");$.getJSON("https://www.personalgenomes.org.uk/data/json/out.json",function(e){ES.makePlotIconClickable(t,"table",e,".file_btn"),$('[data-toggle="tooltip"]').tooltip()}),$.getJSON("https://www.personalgenomes.org.uk/data/json/phenotype.json",function(e){ES.makePlotIconClickable(t,"table",e,".trait_btn"),$('[data-toggle="tooltip"]').tooltip()})})},ES.initializeTable=function(e,t){e=ES.addPlotIconToTopTable(e);var a=$("#"+t).DataTable({data:e,responsive:!0,iDisplayLength:25,pagingType:"full",order:[[1,"asc"]],bAutoWidth:!1,columnDefs:[{targets:5,orderable:!1},{targets:1,orderable:!1},{width:"104px",targets:5}]});return $(".dataTables_filter").addClass("pull-right"),a},ES.addPlotIconToTopTable=function(e){for(var t=0;t<e.length;t++)e[t].push('<button type="button" class="btn btn-default trait_btn" aria-label="Trait Data" data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="Phenotype Data"><span class="glyphicon glyphicon-user" aria-hidden="true"></span></button>&nbsp;&nbsp;<button type="button" class="btn btn-default file_btn" aria-label="Download Files" data-toggle="tooltip" data-trigger="hover" data-placement="bottom" title="Download Files"><span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span></button>');return e},ES.makePlotIconClickable=function(e,t,a,i){$("#"+t).on("click",".close",function(){var t=$(this).closest("tr").prev()[0];e.row(t).child.hide(),t.removeClass("shown")}),$("#"+t).on("click",i,function(){var t=$(this).closest("tr"),r=t.children("td")[0],n=$(r).text(),s=e.row(t);".trait_btn"==i?ES.openTraitsChildRow(s,t,a,n):ES.openFilesChildRow(s,t,a,n)})},ES.openTraitsChildRow=function(e,t,a,i){if(e.child.isShown()&&1===$(e.child()).find("#traits_"+i).length)e.child.hide(),t.removeClass("shown");else{var r=a[i],n=$("#traits_template").clone().attr("id","traits_"+i).show();n=ES.updateTraitsHtml(r,n),e.child(n).show(),t.addClass("shown")}},ES.openFilesChildRow=function(e,t,a,i){if(e.child.isShown()&&1===$(e.child()).find("#files_"+i).length)e.child.hide(),t.removeClass("shown");else{var r=a[i],n=$("#files_template").clone().attr("id","files_"+i).show();n=ES.addEnaFilesHref(n,r),n=ES.addVcfFilesHref(n,r),n=ES.addIdatFilesHref(n,r),e.child(n).show(),t.addClass("shown")}},ES.addEnaFilesHref=function(e,t){return void 0===t.ena?$(e).find(".ena_file_data_row").hide():(e=ES.addBamFileHref(e,t),e=ES.addFastqFilesHref(e,t),e=ES.addSraFileHref(e,t)),e},ES.addBamFileHref=function(e,t){if(void 0===t.ena[0].submitted_ftp)$(e).find(".ena_bam_file").hide();else{$(e).find(".ena_bam_file").show();var a="ftp://"+t.ena[0].submitted_ftp;$(e).find(".ena_bam_file").attr("href",a)}return e},ES.addFastqFilesHref=function(e,t){if(void 0===t.ena[0].fastq_ftp)$(e).find(".ena_fastq_1_file").hide(),$(e).find(".ena_fastq_2_file").hide();else{$(e).find(".ena_fastq_1_file").show(),$(e).find(".ena_fastq_2_file").show();var a=t.ena[0].fastq_ftp.split(";"),i="ftp://"+a[0];$(e).find(".ena_fastq_1_file").attr("href",i);var r="ftp://"+a[1];$(e).find(".ena_fastq_2_file").attr("href",r)}return e},ES.addSraFileHref=function(e,t){if(void 0===t.ena[0].sra_ftp)$(e).find(".ena_sra_file").hide();else{$(e).find(".ena_sra_file").show();var a="ftp://"+t.ena[0].sra_ftp;$(e).find(".ena_sra_file").attr("href",a)}return e},ES.addVcfFilesHref=function(e,t){if(void 0===t.eva)$(e).find(".eva_file_data_row").hide();else{var a=t.eva[0].submitted_ftp.split(";");for(var i in a)if("tbi"==i.split(".").pop()){var r="ftp://"+i;$(e).find(".eva_vcf_tabix_file").attr("href",r)}else if("gz"==i.split(".").pop()){var n="ftp://"+i;$(e).find(".eva_vcf_file").attr("href",n)}}return e},ES.addIdatFilesHref=function(e,t){if(void 0===t.arrayexpress)$(e).find(".array_express_file_data_row").hide();else for(var a=0;a<t.arrayexpress.length;a++){var i="https://www.ebi.ac.uk/arrayexpress/files/"+t.arrayexpress[a].accession+"/"+t.arrayexpress[a].accession+".raw.1.zip/"+t.arrayexpress[a].array_data_file,r=t.arrayexpress[a].array_data_file.split("_")[2];"blood"==t.arrayexpress[a].characteristicsorganism_part?"Red.idat"==r?$(e).find(".array_express_blood_idat_red_file").attr("href",i):$(e).find(".array_express_blood_idat_green_file").attr("href",i):"Red.idat"==r?$(e).find(".array_express_saliva_idat_red_file").attr("href",i):$(e).find(".array_express_saliva_idat_green_file").attr("href",i)}return e},ES.updateTraitsHtml=function(e,t){return void 0===e?($(t).find(".info_table").remove(),$(t).find(".survey_sub_text").text("There is no trait data associated with this participant currently.")):($(t).find(".survey_gender").text(e[1]),$(t).find(".survey_date_of_birth").text(e[2]),$(t).find(".survey_age_at_sample_collection").text(e[3]),$(t).find(".survey_current_smoker").text(e[4]),$(t).find(".survey_ex_smoker").text(e[5]),$(t).find(".survey_blood_type").text(e[6]),$(t).find(".survey_handedness").text(e[7]),$(t).find(".survey_weight").text(e[8]),$(t).find(".survey_height").text(e[9]),$(t).find(".survey_hair_colour").text(e[10]),$(t).find(".survey_right_eye_colour").text(e[11]),$(t).find(".survey_left_eye_colour").text(e[12]),$(t).find(".survey_date").text(e[13])),t};